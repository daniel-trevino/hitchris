function calcY(e){var a=calcSlope(viewPort,destiny),n;return n=a*e-a*viewPort.x+viewPort.y}function calcSlope(e,a){return(e.y-a.y)/(e.x-a.x)}function calcCurrentPlace(e,a){var n=calcMapViewPort(cuernavaca),i=calcMapViewPort(norrkoping),t=calcMapViewPort(stockholm),c=calcMapViewPort(uppsala),o=calcMapViewPort(munich);e==n.x&&a==n.y&&(place=cuernavaca),e==i.x&&a==i.y&&(place=norrkoping),e==t.x&&a==t.y&&(place=stockholm),e==c.x&&a==c.y&&(place=uppsala),e==o.x&&a==o.y&&(place=munich)}function calcMapViewPort(e){var a,n,i,t=document.getElementById("canvas");return n=t.width/2-e.x,n-=e.x,n/=2,i=e.y-t.height/2,i+=t.height/4,i=-i,a={name:e.name,x:n,y:i},place=e,a}var cuernavaca={name:"cuernavaca",x:1042,y:1672},norrkoping={name:"norrkoping",x:2788,y:869},stockholm={name:"stockholm",x:2821,y:847},uppsala={name:"uppsala",x:2817,y:830},munich={name:"munich",x:2726,y:1133},place=cuernavaca,destiny,viewPort,speed=0;$(window).load(function(){function e(){o._x<destiny.x&&0!=speed?(o._x+=speed,o._y=calcY(o._x),calcCurrentPlace(o._x,o._y),o._x>=destiny.x&&0!=speed&&(o._x=destiny.x,o._y=destiny.y,speed=0,calcCurrentPlace(destiny.x,destiny.y))):0!=speed&&(o._x+=-speed,o._y=calcY(o._x)),a(),n(e)}function a(){t.clearRect(0,0,i.width,i.height),t.drawImage(o,o._x,o._y)}var n=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,i=document.getElementById("canvas"),t=i.getContext("2d"),c=window.devicePixelRatio||1;t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight,i.style.width=i.width+"px",i.style.height=i.height+"px",i.width*=c,i.height*=c;var o=new Image;o.onload=e,viewPort=calcMapViewPort(place),o._x=viewPort.x,o._y=viewPort.y,o.src="/img/map.svg",t.scale(c,c),destiny=""}),$(window).resize(function(){function e(){o._x<destiny.x&&0!=speed?(o._x+=speed,o._y=calcY(o._x),calcCurrentPlace(o._x,o._y),o._x>=destiny.x&&0!=speed&&(o._x=destiny.x,o._y=destiny.y,speed=0,calcCurrentPlace(destiny.x,destiny.y))):0!=speed&&(o._x+=-speed,o._y=calcY(o._x)),a(),n(e)}function a(){t.clearRect(0,0,i.width,i.height),t.drawImage(o,o._x,o._y)}var n=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,i=document.getElementById("canvas"),t=i.getContext("2d"),c=window.devicePixelRatio||1;t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight,i.style.width=i.width+"px",i.style.height=i.height+"px",i.width*=c,i.height*=c;var o=new Image;o.onload=e,viewPort=calcMapViewPort(place),o._x=viewPort.x,o._y=viewPort.y,o.src="/img/map.svg",t.scale(c,c),destiny=calcMapViewPort(norrkoping)}),$(window).scroll(function(){var e=$(window).scrollTop();1e3>e&&($("div.locator").removeClass("norrkoping"),$("div.locator").addClass("cuernavaca"),destiny=calcMapViewPort(cuernavaca),speed=10),e>1e3&&1200>e&&($("div.locator").removeClass("cuernavaca"),$("div.locator").removeClass("stockholm"),$("div.locator").addClass("norrkoping"),destiny=calcMapViewPort(norrkoping),speed=10)});