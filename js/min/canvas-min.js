function preventDefault(e){e=e||window.event,e.preventDefault&&(e.preventDefault(),e.returnValue=!1)}function calcMapViewPort(e){var n,a,t,o=document.getElementById("canvas");return a=o.width/2-e.x,a-=e.x,a/=2,t=e.y-o.height/2,t+=o.height/4,t=-t,n={name:e.name,x:a,y:t},place=e,n}function preventDefaultForScrollKeys(e){return keys[e.keyCode]?(preventDefault(e),!1):void 0}function enableScroll(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null}function disableScroll(){window.addEventListener&&window.addEventListener("DOMMouseScroll",preventDefault,!1),window.onwheel=preventDefault,window.onmousewheel=document.onmousewheel=preventDefault,window.ontouchmove=preventDefault,document.onkeydown=preventDefaultForScrollKeys}function draw(){ctx.clearRect(0,0,c.width,c.height),ctx.drawImage(plane,plane._x,plane._y)}function calcSlope(e,n){return(e.y-n.y)/(e.x-n.x)}function calcY(e){var n=calcSlope(viewPort,destiny),a;return a=n*e-n*viewPort.x+viewPort.y}function animate(){plane._x<destiny.x&&0!==speed?(plane._x+=speed,plane._y=calcY(plane._x),plane._x>=destiny.x&&0!==speed&&(plane._x=destiny.x,plane._y=destiny.y,speed=0,enableScroll(),viewPort=calcMapViewPort(window[$("div.locator").data("location")]))):0!==speed&&(disableScroll(),plane._x+=-speed,plane._y=calcY(plane._x)),draw(),isRunning&&(checkStatusOfSpeed(),reqAnimFrame(animate))}function checkStatusOfSpeed(){0===speed||isRunning?0===speed&&isRunning&&(isRunning=!1):(isRunning=!0,animate())}function checkWhichLocation(){var e=$(window).scrollTop(),n=$(".locator"),a=$(".map"),t=$(window).height();t+t/2>e&&(a.removeClass("open"),n.data("location","").removeClass("open cuernavaca")),e>=2*t&&2.5*t>e&&"cuernavaca"!==n.data("location")&&(a.addClass("open"),n.data("location","cuernavaca").addClass("open cuernavaca"),destiny=calcMapViewPort(cuernavaca),speed=10,checkStatusOfSpeed()),e>1e3&&1200>e&&"norrkoping"!==n.data("location")&&(n.data("location","norrkoping").addClass("open norrkoping"),destiny=calcMapViewPort(norrkoping),speed=10,checkStatusOfSpeed()),e>1200&&1800>e&&"stockholm"!==n.data("location")&&(n.data("location","stockholm"),destiny=calcMapViewPort(stockholm),speed=1,checkStatusOfSpeed()),e>1800&&2400>e&&"uppsala"!==n.data("location")&&(n.data("location","uppsala"),destiny=calcMapViewPort(uppsala),speed=1,checkStatusOfSpeed()),e>2400&&"munich"!==n.data("location")&&(n.data("location","munich"),destiny=calcMapViewPort(munich),speed=1,checkStatusOfSpeed())}var $window=$(window),cuernavaca={name:"cuernavaca",x:1042,y:1672},norrkoping={name:"norrkoping",x:2788,y:869},stockholm={name:"stockholm",x:2821,y:847},uppsala={name:"uppsala",x:2817,y:830},munich={name:"munich",x:2726,y:1133},place=cuernavaca,speed=0,isRunning=!0,c,ctx,reqAnimFrame,plane,destiny,viewPort,keys={37:1,38:1,39:1,40:1};$(window).scroll(function(){checkWhichLocation()}),$(window).load(function(){checkWhichLocation(),speed=0,reqAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,c=document.getElementById("canvas"),ctx=c.getContext("2d");var e=window.devicePixelRatio||1;ctx.canvas.width=window.innerWidth,ctx.canvas.height=window.innerHeight,c.style.width=c.width+"px",c.style.height=c.height+"px",c.width*=e,c.height*=e,plane=new Image,plane.onload=animate,viewPort=calcMapViewPort(window[$("div.locator").data("location")]),plane._x=viewPort.x,plane._y=viewPort.y,plane.src="/img/map.svg",ctx.scale(e,e),animate(),checkStatusOfSpeed()}),$(window).resize(function(){checkWhichLocation(),speed=0,reqAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,c=document.getElementById("canvas"),ctx=c.getContext("2d");var e=window.devicePixelRatio||1;ctx.canvas.width=window.innerWidth,ctx.canvas.height=window.innerHeight,c.style.width=c.width+"px",c.style.height=c.height+"px",c.width*=e,c.height*=e,plane=new Image,plane.onload=animate,loaded=!0,viewPort=calcMapViewPort(window[$("div.locator").data("location")]),plane._x=viewPort.x,plane._y=viewPort.y,plane.src="/img/map.svg",ctx.scale(e,e),animate(),checkStatusOfSpeed()}),$window.trigger("scroll"),$window.trigger("resize");