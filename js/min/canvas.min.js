function animate(){plane._x<destiny.x&&0!=speed?(plane._x+=speed,plane._y=calcY(plane._x),plane._x>=destiny.x&&0!=speed&&(plane._x=destiny.x,plane._y=destiny.y,speed=0,enableScroll(),viewPort=calcMapViewPort(window[$("div.locator").data("location")]))):0!=speed&&(disableScroll(),plane._x+=-speed,plane._y=calcY(plane._x)),draw(),reqAnimFrame(animate)}function draw(){ctx.clearRect(0,0,c.width,c.height),ctx.drawImage(plane,plane._x,plane._y)}function calcY(e){var n=calcSlope(viewPort,destiny),a;return a=n*e-n*viewPort.x+viewPort.y}function calcSlope(e,n){return(e.y-n.y)/(e.x-n.x)}function preventDefault(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1}function preventDefaultForScrollKeys(e){return keys[e.keyCode]?(preventDefault(e),!1):void 0}function disableScroll(){window.addEventListener&&window.addEventListener("DOMMouseScroll",preventDefault,!1),window.onwheel=preventDefault,window.onmousewheel=document.onmousewheel=preventDefault,window.ontouchmove=preventDefault,document.onkeydown=preventDefaultForScrollKeys}function enableScroll(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null}function calcMapViewPort(e){var n,a,t,i=document.getElementById("canvas");return a=i.width/2-e.x,a-=e.x,a/=2,t=e.y-i.height/2,t+=i.height/4,t=-t,n={name:e.name,x:a,y:t},place=e,n}function checkWhichLocation(){var e=$(window).scrollTop();$div=$("div.locator"),1e3>e&&"cuernavaca"!=$div.data("location")&&($div.data("location","cuernavaca"),destiny=calcMapViewPort(cuernavaca),speed=10),e>1e3&&1200>e&&"norrkoping"!=$div.data("location")&&($div.data("location","norrkoping"),destiny=calcMapViewPort(norrkoping),speed=10),e>1200&&1800>e&&"stockholm"!=$div.data("location")&&($div.data("location","stockholm"),destiny=calcMapViewPort(stockholm),speed=1),e>1800&&2400>e&&"uppsala"!=$div.data("location")&&($div.data("location","uppsala"),destiny=calcMapViewPort(uppsala),speed=1),e>2400&&"munich"!=$div.data("location")&&($div.data("location","munich"),destiny=calcMapViewPort(munich),speed=1)}var cuernavaca={name:"cuernavaca",x:1042,y:1672},norrkoping={name:"norrkoping",x:2788,y:869},stockholm={name:"stockholm",x:2821,y:847},uppsala={name:"uppsala",x:2817,y:830},munich={name:"munich",x:2726,y:1133},place=cuernavaca,speed=0,c,ctx,reqAnimFrame,plane,destiny,viewPort;$(window).load(function(){checkWhichLocation(),speed=0,reqAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,c=document.getElementById("canvas"),ctx=c.getContext("2d");var e=window.devicePixelRatio||1;ctx.canvas.width=window.innerWidth,ctx.canvas.height=window.innerHeight,c.style.width=c.width+"px",c.style.height=c.height+"px",c.width*=e,c.height*=e,plane=new Image,plane.onload=animate,viewPort=calcMapViewPort(window[$("div.locator").data("location")]),plane._x=viewPort.x,plane._y=viewPort.y,plane.src="/img/map.svg",ctx.scale(e,e),animate()}),$(window).resize(function(){checkWhichLocation(),speed=0,reqAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,c=document.getElementById("canvas"),ctx=c.getContext("2d");var e=window.devicePixelRatio||1;ctx.canvas.width=window.innerWidth,ctx.canvas.height=window.innerHeight,c.style.width=c.width+"px",c.style.height=c.height+"px",c.width*=e,c.height*=e,plane=new Image,plane.onload=animate,viewPort=calcMapViewPort(window[$("div.locator").data("location")]),plane._x=viewPort.x,plane._y=viewPort.y,plane.src="/img/map.svg",ctx.scale(e,e),animate()});var keys={37:1,38:1,39:1,40:1};$(window).scroll(function(){checkWhichLocation()});